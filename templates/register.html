<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Movie_match Register</title>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#FF4D8C", // Vibrant pink for branding
                        secondary: "#6366F1", // Indigo accent
                        "text-main": "#1F2937",
                        "text-muted": "#9CA3AF",
                        "input-bg": "#F9FAFB",
                        "input-border": "#E5E7EB",
                        "btn-light": "#F3F4F6",
                    },
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                    },
                    borderRadius: {
                        DEFAULT: "12px",
                        "xl": "16px",
                        "2xl": "24px",
                        "3xl": "32px",
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'glow': '0 0 15px rgba(255, 77, 140, 0.3)',
                    }
                },
            },
        };
    </script>
    <style>
        body {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>

<body class="bg-white font-sans min-h-screen flex flex-col items-center justify-center p-6 relative overflow-hidden">
    <!-- Background gradient blobs -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div class="absolute top-[-15%] right-[-5%] w-[500px] h-[500px] bg-blue-50/50 rounded-full blur-[100px]"></div>
        <div class="absolute bottom-[-10%] left-[-10%] w-[400px] h-[400px] bg-pink-50/60 rounded-full blur-[80px]">
        </div>
    </div>

    <div class="w-full max-w-[340px] flex flex-col space-y-10">
        <!-- Header -->
        <div class="text-center space-y-2">
            <div
                class="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-tr from-primary to-purple-500 rounded-2xl shadow-glow mb-4 text-white">
                <span class="material-symbols-outlined text-4xl">movie_filter</span>
            </div>
            <h1 class="text-4xl font-bold text-text-main tracking-tight">
                Movie<span class="text-primary">_</span>match
            </h1>
            <div class="flex justify-center w-full">
                <div class="w-3/4 rounded-full overflow-hidden">
                    <marquee behavior="scroll" direction="left" class="text-primary font-semibold text-sm block">
                        • pick movie(s) • find match(s) • pick movie(s) • find match(s) • pick movie(s) • find match(s)
                        •
                    </marquee>
                </div>
            </div>
        </div>

        <!-- Register Form -->
        <form method="POST" action="{% url 'add' %}" class="flex flex-col space-y-5">
            {% csrf_token %}

            <!-- Username Field -->
            <div class="space-y-1.5">
                <div class="flex items-center gap-2 ml-1">
                    <label class="block text-sm font-semibold text-text-main uppercase tracking-wide opacity-80"
                        for="username">
                        Username
                    </label>
                    <p id="status_message" class="text-xs  hidden"></p>
                </div>
                <div class="relative group">
                    <span
                        class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-primary transition-colors">
                        <span class="material-symbols-outlined text-[20px]" style="margin-top:7px;">person</span>
                    </span>
                    <input
                        class="w-full h-12 pl-11 pr-4 bg-input-bg border border-input-border rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/10 focus:outline-none text-gray-800 text-base transition-all placeholder-gray-400 hover:border-gray-300"
                        id="username" name="username" placeholder="Choose a username" type="text" required />
                </div>
            </div>

            <!-- Check Username Button -->
            <div class="flex justify-center">
                <button
                    class="w-full h-12 flex items-center justify-center space-x-2 bg-secondary/10 border-2 border-secondary/30 hover:bg-secondary/20 hover:border-secondary/50 text-secondary font-semibold rounded-xl transition-all transform active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed"
                    type="button" id="check_username">
                    <span class="material-symbols-outlined text-[20px]">search</span>
                    <span>Check Username</span>
                </button>
            </div>

            <!-- Password Field -->
            <div class="space-y-1.5">
                <div class="flex items-center gap-2 ml-1">
                    <label class="block text-sm font-semibold text-text-main uppercase tracking-wide opacity-80"
                        for="password">
                        Password
                    </label>
                    <p class="text-xs text-text-muted ">(8-15 characters)</p>
                </div>
                <div class="relative group">
                    <span
                        class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-primary transition-colors">
                        <span class="material-symbols-outlined text-[20px]" style="margin-top:7px;">lock</span>
                    </span>
                    <input
                        class="w-full h-12 pl-11 pr-12 bg-input-bg border border-input-border rounded-xl focus:border-primary focus:ring-2 focus:ring-primary/10 focus:outline-none text-gray-800 text-base transition-all placeholder-gray-400 hover:border-gray-300"
                        id="password" name="password" placeholder="Create a password" type="password" required
                        minlength="8" maxlength="15" />
                    <button aria-label="Toggle password visibility"
                        class="absolute right-4 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors focus:outline-none cursor-pointer p-1"
                        type="button" id="toggle_password">
                        <span class="material-symbols-outlined text-[20px]" id="eye_icon"
                            style="margin-top:9px;">visibility</span>
                    </button>
                </div>
            </div>

            <!-- Buttons -->
            <div class="pt-6 space-y-3 flex flex-col items-center w-full">
                <button
                    class="w-full h-14 flex items-center justify-center space-x-2 bg-gradient-to-r from-gray-900 to-gray-800 hover:from-black hover:to-gray-900 text-white font-semibold rounded-2xl shadow-lg shadow-gray-200 transition-all transform active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed"
                    type="submit" id="register_btn">
                    <span>Register</span>
                    <span class="material-symbols-outlined text-[20px]">person_add</span>
                </button>
                <button type="button" id="cancel_btn"
                    class="w-full h-14 flex items-center justify-center space-x-2 bg-white border-2 border-gray-100 hover:bg-gray-50 hover:border-gray-200 text-gray-700 font-semibold rounded-2xl transition-all transform active:scale-[0.98]">
                    <span class="material-symbols-outlined text-[20px]">arrow_back</span>
                    <span>Back to Login</span>
                </button>
            </div>
        </form>

    </div>

    <script>
        // Prevent form resubmission
        if (window.history.replaceState) {
            window.history.replaceState(null, null, window.location.href);
        }

        document.addEventListener("DOMContentLoaded", function () {
            const usernameInput = document.getElementById("username");
            const passwordInput = document.getElementById("password");
            const checkBtn = document.getElementById("check_username");
            const registerBtn = document.getElementById("register_btn");
            const statusMessage = document.getElementById("status_message");
            const cancelBtn = document.getElementById("cancel_btn");
            const togglePassword = document.getElementById("toggle_password");
            const eyeIcon = document.getElementById("eye_icon");

            // Initially disable buttons
            checkBtn.disabled = true;
            registerBtn.disabled = true;

            // Enable check button when username is entered
            usernameInput.addEventListener("input", function () {
                checkBtn.disabled = usernameInput.value.trim() === "";
                registerBtn.disabled = true; // Disable until new username is checked
                statusMessage.innerHTML = ""; // Clear status
                statusMessage.classList.add("hidden");
            });

            // Enable register button when password meets requirements
            passwordInput.addEventListener("input", function () {
                // Only enable if username is already confirmed unique
                if (statusMessage.textContent === "Unique username" && passwordInput.value.length >= 8) {
                    registerBtn.disabled = false;
                } else {
                    registerBtn.disabled = true;
                }
            });

            // Check username availability
            checkBtn.addEventListener("click", async function (event) {
                event.preventDefault();
                const username = usernameInput.value.trim();
                const safeUsername = encodeURIComponent(username);

                try {
                    const data = await fetch(`/register/check_username/?username=${safeUsername}`);
                    const response = await data.json();

                    if (response.exist_username) {
                        statusMessage.innerHTML = "Username already exists";
                        statusMessage.classList.remove("hidden");
                        statusMessage.classList.remove("text-green-500");
                        statusMessage.classList.add("text-red-500");
                        registerBtn.disabled = true;
                    } else if (response.unique_username) {
                        usernameInput.value = response.unique_username;
                        statusMessage.innerHTML = "Unique username";
                        statusMessage.classList.remove("hidden");
                        statusMessage.classList.remove("text-red-500");
                        statusMessage.classList.add("text-green-500");

                        // Enable register button if password is already filled correctly
                        if (passwordInput.value.length >= 8) {
                            registerBtn.disabled = false;
                        }
                    }
                } catch (error) {
                    console.error("Error checking username:", error);
                }
            });

            // Back button
            cancelBtn.addEventListener("click", function (event) {
                window.location.href = `/`;
            });

            // Password visibility toggle
            togglePassword.addEventListener("click", function () {
                const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
                passwordInput.setAttribute("type", type);

                if (type === "password") {
                    eyeIcon.textContent = "visibility";
                } else {
                    eyeIcon.textContent = "visibility_off";
                }
            });
        });
    </script>
</body>

</html>